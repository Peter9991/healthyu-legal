<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Reset Password | HealthyU</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Inter, Arial, sans-serif; background: #f7f7fa; color: #222; }
    .container { max-width: 400px; margin: 60px auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 8px #0001; padding: 32px; }
    h2 { color: #22D231; }
    input, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 6px; border: 1px solid #ccc; }
    button { background: #22D231; color: #fff; border: none; font-weight: bold; cursor: pointer; }
    .msg { margin: 12px 0; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>
</head>
<body>
  <div class="container">
    <h2>Reset Your Password</h2>
    <form id="resetForm">
      <input type="password" id="password" placeholder="New password" required minlength="8" />
      <input type="password" id="confirm" placeholder="Confirm new password" required minlength="8" />
      <button type="submit" id="submitBtn">Reset Password</button>
    </form>
    <div class="msg" id="msg"></div>
  </div>
  <script>
    // Parse query params
    function getQueryParam(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name);
    }
    const userId = getQueryParam('userId');
    const secret = getQueryParam('secret');
    const msgDiv = document.getElementById('msg');
    if (!userId || !secret) {
      msgDiv.textContent = "Invalid or missing reset link.";
      document.getElementById('resetForm').style.display = 'none';
    }

    // Appwrite setup
    const client = new window.Appwrite.Client();
    client.setEndpoint('https://fra.cloud.appwrite.io/v1').setProject('67e3118c001bb9d73782');
    const account = new window.Appwrite.Account(client);

    document.getElementById('resetForm').onsubmit = async function(e) {
      e.preventDefault();
      msgDiv.textContent = '';
      const password = document.getElementById('password').value;
      const confirm = document.getElementById('confirm').value;
      if (password !== confirm) {
        msgDiv.textContent = "Passwords do not match.";
        return;
      }
      document.getElementById('submitBtn').disabled = true;
      try {
        await account.updateRecovery(userId, secret, password);
        msgDiv.style.color = "#22D231";
        msgDiv.textContent = "Password reset successful! You can now sign in.";
        document.getElementById('resetForm').style.display = 'none';
      } catch (err) {
        msgDiv.style.color = "#c00";
        msgDiv.textContent = err.message || "Failed to reset password. The link may be expired or invalid.";
      }
      document.getElementById('submitBtn').disabled = false;
    };
  </script>
</body>
</html>
